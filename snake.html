<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snakes and Ladders</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap">
    <!-- Tone.js for sound effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
        }
        canvas {
            border: 2px solid #4a5568;
            background-color: #e2e8f0;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            max-width: 90vw;
            max-height: 90vh;
        }
        .container-shadow {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .dice-animation {
            animation: roll 0.5s ease-in-out infinite;
        }
        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }
        .dice-display {
            transition: transform 0.2s ease-in-out;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="flex flex-col lg:flex-row items-center justify-center space-y-8 lg:space-y-0 lg:space-x-12 container-shadow rounded-3xl p-8 bg-gray-800 text-gray-200">
        <!-- Game Board -->
        <canvas id="gameCanvas" class="w-full h-full"></canvas>

        <!-- Control Panel -->
        <div class="flex flex-col items-center space-y-6 w-full lg:w-1/3">
            <h1 class="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-600 drop-shadow-lg">Snakes and Ladders</h1>
            
            <div class="w-full flex justify-center space-x-4 items-center p-4 rounded-xl bg-gray-700 shadow-inner">
                <div class="flex items-center space-x-2">
                    <span class="w-4 h-4 rounded-full" style="background-color: #ff6347;"></span>
                    <span class="font-semibold text-lg">Player 1</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="w-4 h-4 rounded-full" style="background-color: #4682b4;"></span>
                    <span class="font-semibold text-lg">Player 2</span>
                </div>
            </div>

            <div id="status" class="text-xl font-semibold text-center h-12 flex items-center justify-center p-2 rounded-lg w-full bg-gray-700 shadow-inner">
                Player 1's turn
            </div>

            <div class="w-24 h-24 bg-white rounded-xl shadow-lg flex items-center justify-center mb-4 transition-transform duration-200 ease-in-out dice-display" id="diceDisplay">
                <span id="diceValue" class="text-6xl font-bold text-gray-800">1</span>
            </div>

            <button id="rollDiceBtn" class="w-full px-6 py-4 text-xl font-bold rounded-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 text-white shadow-lg transform transition-transform duration-200 hover:scale-105 active:scale-95">
                Roll Dice
            </button>

            <button id="resetBtn" class="w-full px-6 py-4 text-xl font-bold rounded-full bg-gray-600 hover:bg-gray-700 text-white shadow-lg transform transition-transform duration-200 hover:scale-105 active:scale-95">
                Reset Game
            </button>
            
            <!-- Sound Toggle -->
            <button id="soundToggleBtn" class="mt-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-sm font-semibold rounded-full shadow-md transition-colors duration-200">
                Turn Sound Off
            </button>

            <div id="messageBox" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 hidden">
                <div class="bg-gray-800 p-8 rounded-xl shadow-2xl text-center space-y-4 max-w-sm w-full">
                    <p id="messageText" class="text-2xl font-bold text-white"></p>
                    <button id="closeMessageBox" class="px-6 py-2 bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-full shadow-md transition-colors duration-200">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.onload = function() {
            // Get canvas and context
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // Get UI elements
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            const resetBtn = document.getElementById('resetBtn');
            const soundToggleBtn = document.getElementById('soundToggleBtn');
            const statusDiv = document.getElementById('status');
            const diceDisplay = document.getElementById('diceDisplay');
            const diceValueSpan = document.getElementById('diceValue');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBoxBtn = document.getElementById('closeMessageBox');

            // Game constants
            const boardSize = 10;
            const totalSquares = boardSize * boardSize;
            let currentWidth, currentHeight;

            // Define snakes and ladders
            const snakes = {
                16: 6, 47: 26, 49: 11, 56: 53, 62: 19, 64: 60, 87: 24, 93: 73, 95: 75, 98: 78
            };
            const ladders = {
                1: 38, 4: 14, 9: 31, 21: 42, 28: 84, 36: 44, 51: 67, 71: 91, 80: 100
            };

            // Game state
            let playerPositions = [0, 0];
            let currentPlayer = 0; // 0 for Player 1, 1 for Player 2
            let gameOver = false;
            let isRolling = false;
            let isSoundEnabled = true;

            // Initialize Tone.js
            let audioContextInitiated = false;
            
            // Synths for sound effects
            const rollSound = new Tone.Synth().toDestination();
            const moveSound = new Tone.PolySynth(Tone.Synth).toDestination();
            const snakeSound = new Tone.Synth({
                oscillator: { type: 'sine' },
                envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.5 }
            }).toDestination();
            const ladderSound = new Tone.Synth({
                oscillator: { type: 'triangle' },
                envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.5 }
            }).toDestination();
            const winSound = new Tone.Synth({
                oscillator: { type: 'square' },
                envelope: { attack: 0.1, decay: 0.5, sustain: 0.2, release: 1 }
            }).toDestination();

            // Function to handle resizing
            function handleResize() {
                const parent = canvas.parentElement;
                currentWidth = Math.min(parent.offsetWidth, parent.offsetHeight);
                currentHeight = currentWidth;
                canvas.width = currentWidth;
                canvas.height = currentHeight;
                draw();
            }

            // Function to get x, y coordinates from a square number
            function getCoords(square) {
                const boardWidth = canvas.width;
                const boardHeight = canvas.height;
                const squareSize = boardWidth / boardSize;

                if (square === 0) {
                    return { x: squareSize / 2, y: boardHeight - squareSize / 2 };
                }

                const adjustedSquare = square - 1;
                const row = Math.floor(adjustedSquare / boardSize);
                const col = adjustedSquare % boardSize;

                let x, y;
                if (row % 2 === 0) {
                    x = col * squareSize;
                } else {
                    x = (boardSize - 1 - col) * squareSize;
                }
                
                y = (boardSize - 1 - row) * squareSize;

                return {
                    x: x + squareSize / 2,
                    y: y + squareSize / 2
                };
            }

            // Function to draw the board
            function drawBoard() {
                const squareSize = canvas.width / boardSize;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (let row = 0; row < boardSize; row++) {
                    for (let col = 0; col < boardSize; col++) {
                        const squareNum = (row % 2 === 0) ? 
                            (boardSize - 1 - row) * boardSize + (col + 1) :
                            (boardSize - 1 - row) * boardSize + (boardSize - col);

                        const x = (row % 2 === 0) ? col * squareSize : (boardSize - 1 - col) * squareSize;
                        const y = (boardSize - 1 - row) * squareSize;

                        ctx.fillStyle = (row + col) % 2 === 0 ? '#cbd5e0' : '#e2e8f0';
                        ctx.fillRect(x, y, squareSize, squareSize);
                        
                        ctx.fillStyle = '#4a5568';
                        ctx.font = `${squareSize / 4}px Inter`;
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillText(squareNum, x + squareSize / 2, y + squareSize / 2);
                    }
                }
            }
            
            // Function to draw snakes and ladders
            function drawSnakesAndLadders() {
                const squareSize = canvas.width / boardSize;

                // Draw Ladders
                for (const start in ladders) {
                    const end = ladders[start];
                    const startCoords = getCoords(parseInt(start));
                    const endCoords = getCoords(end);
                    const offset = squareSize / 8;
                    
                    // Ladder rails
                    ctx.strokeStyle = '#48bb78'; // Green
                    ctx.lineWidth = squareSize / 20;
                    ctx.beginPath();
                    ctx.moveTo(startCoords.x - offset, startCoords.y - offset);
                    ctx.lineTo(endCoords.x - offset, endCoords.y - offset);
                    ctx.stroke();

                    ctx.beginPath();
                    ctx.moveTo(startCoords.x + offset, startCoords.y + offset);
                    ctx.lineTo(endCoords.x + offset, endCoords.y + offset);
                    ctx.stroke();

                    // Ladder rungs
                    ctx.lineWidth = squareSize / 40;
                    ctx.strokeStyle = '#2f855a'; // Darker green
                    const distanceX = endCoords.x - startCoords.x;
                    const distanceY = endCoords.y - startCoords.y;
                    const rungCount = Math.floor(Math.sqrt(distanceX * distanceX + distanceY * distanceY) / squareSize);
                    
                    for (let i = 1; i < rungCount; i++) {
                        const r = i / rungCount;
                        const rungX1 = startCoords.x + r * distanceX - offset;
                        const rungY1 = startCoords.y + r * distanceY - offset;
                        const rungX2 = startCoords.x + r * distanceX + offset;
                        const rungY2 = startCoords.y + r * distanceY + offset;
                        
                        ctx.beginPath();
                        ctx.moveTo(rungX1, rungY1);
                        ctx.lineTo(rungX2, rungY2);
                        ctx.stroke();
                    }
                }

                // Draw Snakes
                for (const start in snakes) {
                    const end = snakes[start];
                    const startCoords = getCoords(parseInt(start));
                    const endCoords = getCoords(end);
                    
                    ctx.strokeStyle = '#e53e3e'; // Red
                    ctx.lineWidth = squareSize / 10;
                    ctx.lineCap = 'round';
                    
                    const midX = (startCoords.x + endCoords.x) / 2;
                    const midY = (startCoords.y + endCoords.y) / 2;
                    const curveOffset = squareSize * 1.5;

                    ctx.beginPath();
                    ctx.moveTo(startCoords.x, startCoords.y);
                    // Use multiple bezier curves to create a snake-like path
                    ctx.bezierCurveTo(
                        midX - curveOffset, midY + curveOffset,
                        midX + curveOffset, midY - curveOffset,
                        endCoords.x, endCoords.y
                    );
                    ctx.stroke();

                    // Snake head
                    ctx.fillStyle = '#c53030';
                    ctx.beginPath();
                    ctx.arc(startCoords.x, startCoords.y, squareSize / 6, 0, Math.PI * 2);
                    ctx.fill();

                    // Snake tail
                    ctx.fillStyle = '#c53030';
                    ctx.beginPath();
                    ctx.arc(endCoords.x, endCoords.y, squareSize / 8, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // Function to draw players
            function drawPlayers() {
                const squareSize = canvas.width / boardSize;
                const radius = squareSize / 4;
                
                const player1Pos = getCoords(playerPositions[0]);
                const player2Pos = getCoords(playerPositions[1]);
                
                // Draw player 1 (Red)
                ctx.fillStyle = '#ff6347';
                ctx.beginPath();
                ctx.arc(player1Pos.x - radius, player1Pos.y, radius, 0, Math.PI * 2);
                ctx.fill();

                // Draw player 2 (Blue)
                ctx.fillStyle = '#4682b4';
                ctx.beginPath();
                ctx.arc(player2Pos.x + radius, player2Pos.y, radius, 0, Math.PI * 2);
                ctx.fill();
            }

            // Main draw function
            function draw() {
                drawBoard();
                drawSnakesAndLadders();
                drawPlayers();
            }

            // Function to handle dice roll
            async function rollDice() {
                if (gameOver || isRolling) {
                    return;
                }

                if (!audioContextInitiated) {
                    await Tone.start();
                    audioContextInitiated = true;
                }

                isRolling = true;
                rollDiceBtn.disabled = true;
                diceDisplay.classList.add('dice-animation');

                // Play a rolling sound
                if (isSoundEnabled) {
                    rollSound.triggerAttackRelease('C4', '8n');
                }

                let rollCount = 0;
                const rollInterval = setInterval(() => {
                    const randomRoll = Math.floor(Math.random() * 6) + 1;
                    diceValueSpan.textContent = randomRoll;
                    rollCount++;
                    if (rollCount > 10) {
                        clearInterval(rollInterval);
                        isRolling = false;
                        diceDisplay.classList.remove('dice-animation');
                        
                        movePlayer(randomRoll);
                    }
                }, 100);
            }
            
            // Function to move the player
            function movePlayer(roll) {
                const newPosition = playerPositions[currentPlayer] + roll;
                let finalPosition = newPosition;
                
                // Don't move if the new position is beyond the last square
                if (newPosition > totalSquares) {
                    finalPosition = playerPositions[currentPlayer];
                } else {
                    // Animate player movement
                    let currentPos = playerPositions[currentPlayer];
                    const moveInterval = setInterval(() => {
                        if (currentPos < newPosition) {
                            currentPos++;
                            playerPositions[currentPlayer] = currentPos;
                            draw();
                            if (isSoundEnabled) {
                                moveSound.triggerAttackRelease(["C5", "E5"], "16n");
                            }
                        } else {
                            clearInterval(moveInterval);
                            
                            // Check for snake or ladder
                            const newSq = playerPositions[currentPlayer];
                            if (ladders[newSq]) {
                                setTimeout(() => {
                                    if (isSoundEnabled) ladderSound.triggerAttackRelease('F4', '0.5');
                                    playerPositions[currentPlayer] = ladders[newSq];
                                    draw();
                                    updateStatus(`Player ${currentPlayer + 1} climbs a ladder to ${ladders[newSq]}!`);
                                    checkWin();
                                    setTimeout(() => togglePlayer(), 1000);
                                }, 500);
                            } else if (snakes[newSq]) {
                                setTimeout(() => {
                                    if (isSoundEnabled) snakeSound.triggerAttackRelease('C2', '0.5');
                                    playerPositions[currentPlayer] = snakes[newSq];
                                    draw();
                                    updateStatus(`Player ${currentPlayer + 1} got bit by a snake! Down to ${snakes[newSq]}.`);
                                    checkWin();
                                    setTimeout(() => togglePlayer(), 1000);
                                }, 500);
                            } else {
                                checkWin();
                                togglePlayer();
                            }
                        }
                    }, 200);
                }
            }

            // Function to switch players
            function togglePlayer() {
                if (!gameOver) {
                    currentPlayer = 1 - currentPlayer;
                    updateStatus(`Player ${currentPlayer + 1}'s turn`);
                    rollDiceBtn.disabled = false;
                }
            }
            
            // Check for a win
            function checkWin() {
                if (playerPositions[currentPlayer] === totalSquares) {
                    gameOver = true;
                    if (isSoundEnabled) {
                        winSound.triggerAttackRelease('C6', '1');
                    }
                    showMessageBox(`Player ${currentPlayer + 1} wins!`);
                    updateStatus(`Player ${currentPlayer + 1} wins!`);
                    rollDiceBtn.disabled = true;
                }
            }

            // Update status message
            function updateStatus(message) {
                statusDiv.textContent = message;
            }

            // Show a custom message box
            function showMessageBox(message) {
                messageText.textContent = message;
                messageBox.classList.remove('hidden');
            }

            // Event listeners
            rollDiceBtn.addEventListener('click', rollDice);
            resetBtn.addEventListener('click', () => {
                playerPositions = [0, 0];
                currentPlayer = 0;
                gameOver = false;
                updateStatus(`Player 1's turn`);
                rollDiceBtn.disabled = false;
                diceValueSpan.textContent = "1";
                draw();
            });
            closeMessageBoxBtn.addEventListener('click', () => {
                messageBox.classList.add('hidden');
            });
            
            // Sound toggle
            soundToggleBtn.addEventListener('click', () => {
                isSoundEnabled = !isSoundEnabled;
                soundToggleBtn.textContent = isSoundEnabled ? 'Turn Sound Off' : 'Turn Sound On';
            });
            
            // Initial setup
            handleResize();
            window.addEventListener('resize', handleResize);
        }
    </script>
</body>
</html>
